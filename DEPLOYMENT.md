# Acta Diurna - Production Deployment Guide

## Overview
This guide covers deploying the Acta Diurna application (FastAPI backend + React frontend + MongoDB) to Render.

## Prerequisites

### 1. MongoDB Atlas Setup
1. **Create MongoDB Atlas Account**: Go to [MongoDB Atlas](https://www.mongodb.com/atlas)
2. **Create a New Cluster**: Choose the free tier
3. **Configure Network Access**: 
   - Go to Network Access → Add IP Address
   - Select "Allow access from anywhere" (0.0.0.0/0) for Render deployment
4. **Create Database User**:
   - Go to Database Access → Add New Database User
   - Create a user with read/write permissions
   - Save the username and password
5. **Get Connection String**:
   - Go to Clusters → Connect → Connect your application
   - Copy the connection string (replace `<password>` with your user password)
   - Example: `mongodb+srv://<username>:<password>@cluster0.xxxxx.mongodb.net/acta_diurna?retryWrites=true&w=majority`

### 2. GitHub Repository
1. **Push Code to GitHub**: Ensure your code is in a GitHub repository
2. **Repository Structure**: Make sure you have the correct structure:
   ```
   /your-repo
     /backend
       - server.py
       - requirements.txt
       - models.py
       - database.py
       - auth.py
       - utils.py
     /frontend
       - package.json
       - src/
       - public/
     - render.yaml
   ```

## Deployment Steps

### 1. Deploy to Render

1. **Connect GitHub to Render**:
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Sign up/Login with your GitHub account
   - Authorize Render to access your repositories

2. **Create New Service from render.yaml**:
   - Click "New" → "Blueprint"
   - Select your GitHub repository
   - Render will automatically detect the `render.yaml` file
   - Review the services that will be created:
     - `acta-diurna-backend` (FastAPI)
     - `acta-diurna-frontend` (React)

3. **Configure Environment Variables**:

   **For Backend Service (`acta-diurna-backend`)**:
   - `MONGO_URL`: Your MongoDB Atlas connection string
   - `SECRET_KEY`: Auto-generated by Render
   - `ENVIRONMENT`: `production`
   - `PORT`: `8001`

   **For Frontend Service (`acta-diurna-frontend`)**:
   - `REACT_APP_BACKEND_URL`: `https://acta-diurna-backend.onrender.com/api`
   - `NODE_ENV`: `production`
   - `PORT`: `3000`

4. **Deploy Services**:
   - Click "Apply" to create and deploy both services
   - Monitor the build logs for any issues

### 2. Post-Deployment Configuration

1. **Update CORS Origins** (if needed):
   - If you have a custom domain, update the CORS origins in `backend/server.py`
   - Add your production frontend URL to the allowed origins

2. **Test the Application**:
   - Visit your frontend URL (e.g., `https://acta-diurna-frontend.onrender.com`)
   - Test user registration, login, and core functionality
   - Verify backend API endpoints work correctly

### 3. Production Optimization

1. **Database Indexes**: The app automatically creates necessary indexes on startup

2. **Monitoring**: 
   - Use Render's built-in monitoring
   - Check logs for any issues: Dashboard → Service → Logs

3. **Security**:
   - CORS is configured for production
   - All API endpoints use proper authentication
   - Environment variables are secure

## Environment Variables Reference

### Backend (.env or Render environment variables)
```
MONGO_URL=mongodb+srv://username:password@cluster0.xxxxx.mongodb.net/acta_diurna?retryWrites=true&w=majority
SECRET_KEY=your-secret-key-for-jwt
ENVIRONMENT=production
PORT=8001
DB_NAME=acta_diurna
```

### Frontend (.env or Render environment variables)
```
REACT_APP_BACKEND_URL=https://acta-diurna-backend.onrender.com/api
NODE_ENV=production
PORT=3000
```

## Troubleshooting

### Common Issues

1. **Build Failures**:
   - Check build logs in Render dashboard
   - Ensure all dependencies are in requirements.txt/package.json
   - Verify file paths in render.yaml

2. **Database Connection Issues**:
   - Verify MongoDB Atlas connection string
   - Check network access settings in MongoDB Atlas
   - Ensure database user has proper permissions

3. **CORS Issues**:
   - Verify frontend URL in CORS origins
   - Check that API calls use the correct backend URL

4. **Environment Variables**:
   - Ensure all required variables are set in Render dashboard
   - Check variable names match exactly

### Health Check Endpoints

- **Backend Health**: `https://acta-diurna-backend.onrender.com/api/health`
- **Frontend**: Access the main URL to verify React app loads

## Scaling and Monitoring

1. **Free Tier Limitations**:
   - Services sleep after 15 minutes of inactivity
   - 750 hours/month per service
   - Consider upgrading to paid plans for production use

2. **Performance Monitoring**:
   - Monitor response times in Render dashboard
   - Check database performance in MongoDB Atlas
   - Set up alerts for service downtime

## Security Best Practices

1. **Environment Variables**: Never commit sensitive data to Git
2. **HTTPS**: Render provides HTTPS by default
3. **Authentication**: JWT tokens with proper expiration
4. **CORS**: Restricted to specific origins in production
5. **Database**: MongoDB Atlas with authentication and network restrictions

## Support

- **Render Documentation**: https://render.com/docs
- **MongoDB Atlas Documentation**: https://docs.atlas.mongodb.com/
- **FastAPI Documentation**: https://fastapi.tiangolo.com/
- **React Documentation**: https://react.dev/

## Application URLs (After Deployment)

- **Frontend**: `https://acta-diurna-frontend.onrender.com`
- **Backend API**: `https://acta-diurna-backend.onrender.com/api`
- **API Documentation**: `https://acta-diurna-backend.onrender.com/docs`